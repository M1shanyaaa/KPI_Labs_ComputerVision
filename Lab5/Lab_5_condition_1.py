import cv2 as cvimport numpy as npfrom tkinter import *from PIL import Image, ImageTk# === Параметри ===before_path = "Before.png"after_path = "After.png"WIDTH_KM = 145HEIGHT_KM = 105FIXED_SIZE = 600# Попередня обробкаdef preprocess(path):    img = cv.imread(path)    if img is None:        raise FileNotFoundError(path)    img = cv.resize(img, (FIXED_SIZE, FIXED_SIZE))    img = cv.GaussianBlur(img, (5, 5), 0)    hsv = cv.cvtColor(img, cv.COLOR_BGR2HSV)    return img, hsv# K-Means кластеризаціяdef segment_kmeans(hsv_img, k=8):    data = hsv_img.reshape((-1, 3)).astype(np.float32)    criteria = (cv.TERM_CRITERIA_EPS + cv.TERM_CRITERIA_MAX_ITER, 15, 1.0)    _, labels, centers = cv.kmeans(data, k, None, criteria, 10, cv.KMEANS_PP_CENTERS)    centers = np.uint8(centers)    segmented = centers[labels.flatten()].reshape(hsv_img.shape)    return cv.cvtColor(segmented, cv.COLOR_HSV2BGR), centers#Створення маски водиdef create_water_mask(hsv_img, centers, hmin=80, hmax=130, smin=40, vmax=160):    # Створюємо маску через відстань до кластерів    h, s, v = cv.split(hsv_img)    mask = cv.inRange(hsv_img, (hmin, smin, 0), (hmax, 255, vmax))    # Морфологічна обробка для чистоти контуру    kernel = np.ones((5, 5), np.uint8)    mask = cv.morphologyEx(mask, cv.MORPH_OPEN, kernel)    mask = cv.morphologyEx(mask, cv.MORPH_CLOSE, kernel)    # Згладжуємо межі    mask = cv.GaussianBlur(mask, (5, 5), 0)    _, mask = cv.threshold(mask, 100, 255, cv.THRESH_BINARY)    return mask# Основна функціяdef analyze():    seg_bef_bgr, c_b = segment_kmeans(before_hsv)    seg_aft_bgr, c_a = segment_kmeans(after_hsv)    mask_b = create_water_mask(cv.cvtColor(seg_bef_bgr, cv.COLOR_BGR2HSV), c_b)    mask_a = create_water_mask(cv.cvtColor(seg_aft_bgr, cv.COLOR_BGR2HSV), c_a)    # Площа    pix_area = (WIDTH_KM / FIXED_SIZE) * (HEIGHT_KM / FIXED_SIZE)    area_b = np.sum(mask_b > 0) * pix_area    area_a = np.sum(mask_a > 0) * pix_area    delta = area_b - area_a    # Порівняння    diff = cv.subtract(mask_b, mask_a)    red = np.zeros_like(before_img)    red[:, :, 2] = diff    overlay = cv.addWeighted(before_img, 0.6, red, 0.7, 0)    top = np.hstack((before_img, seg_bef_bgr, cv.cvtColor(mask_b, cv.COLOR_GRAY2BGR)))    bottom = np.hstack((after_img, seg_aft_bgr, overlay))    combined = np.vstack((top, bottom))    combined = cv.resize(combined, (1200, 900))    text = f"Water loss = {delta:.1f} km^2"    cv.putText(combined, text, (20, 880), cv.FONT_HERSHEY_SIMPLEX, 0.8, (255, 255, 255), 2)    return combined# Основна частина програмиbefore_img, before_hsv = preprocess(before_path)after_img, after_hsv = preprocess(after_path)result = analyze()root = Tk()root.title("K-Means Аналіз Втрати Води")root.geometry("1300x950")result_rgb = cv.cvtColor(result, cv.COLOR_BGR2RGB)imgtk = ImageTk.PhotoImage(Image.fromarray(result_rgb))panel = Label(root, image=imgtk)panel.pack()root.mainloop()