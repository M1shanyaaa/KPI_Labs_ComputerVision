import globimport osimport shutilimport cv2 as cvimport numpy as npfrom skimage.feature import local_binary_patternfrom sklearn.cluster import KMeansimdir = "Photo_for_clustering"# Цільова папкаtargetdir = "End_photo_for_clustering_CLASSIC/"number_clusters = 3FIXED_SIZE = (128, 128)def extract_classic_features(imagepath):    """    Вилучає класичні ознаки: Гістограма HSV (Колір) та LBP (Текстура).    """    if not os.path.exists(imagepath):        return None    img = cv.imread(imagepath)    if img is None:        return None    img = cv.resize(img, FIXED_SIZE)    # 1. Ознака Кольору    hsv = cv.cvtColor(img, cv.COLOR_BGR2HSV)    hist = cv.calcHist([hsv], [0, 1], None, [50, 60], [0, 180, 0, 256])    cv.normalize(hist, hist)    # 2. Ознака Текстури: Local Binary Pattern (LBP)    gray = cv.cvtColor(img, cv.COLOR_BGR2GRAY)    radius = 2    n_points = 8 * radius    lbp = local_binary_pattern(gray, n_points, radius, method="uniform")    (lbp_hist, _) = np.histogram(lbp.ravel(),                                 bins=np.arange(0, n_points + 3),                                 range=(0, n_points + 2))    lbp_hist = lbp_hist.astype("float")    lbp_hist /= (lbp_hist.sum() + 1e-7)    feature_vector = np.hstack([hist.flatten(), lbp_hist])    return feature_vectordef clustering_without_dl(imdir, targetdir, number_clusters):    print("ЕТАП 1: ВИЛУЧЕННЯ КЛАСИЧНИХ ОЗНАК (HSV + LBP)")    filelist = glob.glob(os.path.join(imdir, '*.png')) + glob.glob(os.path.join(imdir, '*.jpg'))    filelist.sort()    if len(filelist) < number_clusters:        print(f"\nПОМИЛКА: Знайдено лише {len(filelist)} об'єктів. Потрібно мінімум {number_clusters}.")        print(f"Перевірте, чи існують файли у папці: {imdir}")        return    featurelist = []    valid_filelist = []    for i, imagepath in enumerate(filelist):        print(f"    Обробка: {i + 1} / {len(filelist)}", end="\r")        features = extract_classic_features(imagepath)        if features is not None:            featurelist.append(features)            valid_filelist.append(imagepath)        else:            print(f"\n⚠ ПОПЕРЕДЖЕННЯ: Пропущено файл {imagepath}. Помилка завантаження.")    # КЛАСТЕРИЗАЦІЯ K-MEANS    print("\n\nЕТАП 2: КЛАСТЕРИЗАЦІЯ K-MEANS ")    print(f"Кластеризація {len(featurelist)} об'єктів на {number_clusters} кластерів...")    kmeans = KMeans(n_clusters=number_clusters, init='k-means++', n_init=10, random_state=0).fit(np.array(featurelist))    # ЗБЕРЕЖЕННЯ РЕЗУЛЬТАТІВ    print("\nЕТАП 3: КОПІЮВАННЯ ТА ЗБЕРЕЖЕННЯ")    # Створення цільової папки    try:        if os.path.exists(targetdir):            shutil.rmtree(targetdir)        os.makedirs(targetdir)    except OSError:        pass    # Копіювання з перейменуванням    for i, m in enumerate(kmeans.labels_):        original_path = valid_filelist[i]        original_filename = os.path.basename(original_path)        # Створюємо шлях, щоб уникнути копіювання файлу в себе        target_name = os.path.join(targetdir, f"{m}_{original_filename}")        print(f"    Копіювання: {original_filename} -> Кластер {m}", end="\r")        shutil.copy(original_path, target_name)    print("\n\nКластеризація завершена.")    print(f"Результати збережено у папці: {targetdir}")    returnif __name__ == "__main__":    clustering_without_dl(imdir, targetdir, number_clusters)